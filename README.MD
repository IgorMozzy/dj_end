### Модуль 5
_Проект представляет собой веб-приложение для управления списком пользователей (картотека). В приложении реализована функциональность для создания, редактирования, удаления и просмотра пользователей. Также предусмотрена регистрация и авторизация пользователей, управление правами доступа, деплой с использованием Docker, настройка веб-сервера, базы данных и обеспечение безопасности._

### С использованием templates django и crispy forms:
Реализована стартовая страница на / с возможностью авторизации и регистрации, для администраторов редирект в "админ панель" /a/users/ со списком пользователей, пользователям доступны только свои собственные страницы для изменения данных /user/1/.

Признаком администратором считается системная роль джанго staff, группы Admins и Users могут быть в дальнейшем использованы для разграничения доступа к другим разделам.

### С использованием DRF и JWT:
`/api/token/ - {"username": "username", "password": "string"}
Получениу Access и Refresh токенов по данным для авторизации
/api/refresh/ - {"refresh": "string"}
Получение Access токена по Refresh токену`

Для получения информации по группам и пользователям:

`/groups/ - GET, POST,
/groups/{id}/ - GET, PUT, PATCH, DELETE
/users/ - GET, POST
/users/{id}/ - GET, PUT, PATCH, DELETE
Возможные параметры для методов можно увидеть в документации:
/swagger/ - swagger с автодокументацией и возможностью тестирования (при наличии авторизации)
/swagger.json - схема в json`

#### Установка
1. В репозитарии настроен автоматическое тестирование и деплой через GitHub Actions с конфигом, предполагающим разварачивание на сервере с linux и возможностью установки docker+compose.
2. Скрипт установки требует задания в Secrets репозитария параметров SSH_HOST, SSH_PRIVATE_KEY, SSH_USERNAME - для подключения в процессе автоматизированного деплоя к указанной машине по SSH
3. Для успешного подключения в процессе деплоя сервер должен будет подключиться к репозитарию, что также требует наличия на нем приватной части ключа с публичной добавленной в настройки аккаунта гитхаба для авторизации.
4. При необходимости можно предварительно проверить авторизацию с сервера на GitHub: ssh -T git@github.com
5. После самого первого деплоя необходимо скопировать сертификат SSL на сервер, их имена заданы в конфиге nginx, по умолчанию cert.crt cert.key
6. Скорректировать настройки .env файла в папке проекта на сервере: добавить secret key, allowed hosts и DJANGO_CSRF_TRUSTED_ORIGINS (через запятую), например:

    DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1,web,158.160.26.232,somedomain.ru

    DJANGO_CSRF_TRUSTED_ORIGINS=https://somedomain.ru,http://somedomain.ru

7. Пересобрать контейнеры docker compose up -d --build
8. Либо на предыдущем шаге можно скорректировать настройки nginx, удалив пути к файлам сертификатов.
9. Дальнейшие апдейты необходимо делать непосредственно через репозитарий, чтобы не возникало конфликтов при слиянии.
10. После первоначального деплоя также нужно сконфигурировать Grafana, использовав для первого входа дефолтный пароль из переменных окружения. Доступна на порту 3000 по ip хоста с http.
11. Сервер prometheus может быть добавлен в нее по пути http://prometheus:9090
12. Первого суперпользователя можно создать в контейнере web: python3 manage.py createsuperuser

Примеры команд, используемых в процессе
scp -i ./.ssh/key "C:\Users\..." name@IP:<destination path> - копирование ключей
ssh -i ./.ssh/key name@IP - ssh с использованием конкр. ключа
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())" - генерация секретного ключа в джанго
python manage.py seed_data - заполнить БД тестовыми данными из movies/management/seed_data.py

#### Сoverage report
| File                  | Statements | Missed | Coverage |
|-----------------------|------------|--------|----------|
| api\__init__.py | 0 | 0 | 100.00% |
| api\admin.py | 0 | 0 | 100.00% |
| api\apps.py | 4 | 0 | 100.00% |
| api\migrations\__init__.py | 0 | 0 | 100.00% |
| api\models.py | 0 | 0 | 100.00% |
| api\serializers.py | 22 | 0 | 100.00% |
| api\tests.py | 117 | 1 | 99.15% |
| api\urls.py | 10 | 1 | 90.00% |
| api\views.py | 93 | 10 | 89.25% |
| conf\__init__.py | 0 | 0 | 100.00% |
| conf\asgi.py | 4 | 4 | 0.00% |
| conf\middleware.py | 18 | 4 | 77.78% |
| conf\settings.py | 41 | 3 | 92.68% |
| conf\urls.py | 4 | 0 | 100.00% |
| conf\wsgi.py | 4 | 4 | 0.00% |
| manage.py | 11 | 2 | 81.82% |
| users\__init__.py | 0 | 0 | 100.00% |
| users\admin.py | 12 | 0 | 100.00% |
| users\apps.py | 6 | 0 | 100.00% |
| users\forms.py | 23 | 0 | 100.00% |
| users\migrations\0001_initial.py | 7 | 0 | 100.00% |
| users\migrations\__init__.py | 0 | 0 | 100.00% |
| users\models.py | 37 | 5 | 86.49% |
| users\signals.py | 8 | 0 | 100.00% |
| users\tests.py | 96 | 0 | 100.00% |
| users\urls.py | 4 | 0 | 100.00% |
| users\views.py | 140 | 33 | 76.43% |

## Summary
- **Total Statements**: 661
- **Total Missed**: 67
- **Total Coverage**: 89.86%
